package main

import (
	"fmt"
	"time"

	helix "github.com/nicklaw5/helix"
)

func t() {
	client, err := helix.NewClient(&helix.Options{
		ClientID: clientID,
	})
	if err != nil {
		panic(err)
	}

	rURI, err := client.RequestDeviceVerificationURI([]string{"user:read:follows", "user:read:subscriptions", "channel:read:subscriptions"})
	if err != nil {
		panic(err)
	}

	fmt.Println(rURI.Data.VerificationURI)

	ticker := time.NewTicker(5 * time.Second)
	quit := make(chan struct{})
	go func() {
		for {
			select {
			case <-ticker.C:
				rToken, err := client.RequestDeviceAccessToken(rURI.Data.DeviceCode, []string{"user:read:follows", "user:read:subscriptions", "channel:read:subscriptions"})
				if err != nil {
					panic(err)
				}

				fmt.Println(rToken.Data)

				client.SetDeviceAccessToken(rToken.Data.AccessToken)
				client.SetRefreshToken(rToken.Data.RefreshToken)
			case <-quit:
				ticker.Stop()
				return
			}
		}
	}()

	for {
		if client.GetRefreshToken() != "" {
			break
		}
	}

	resp, err := client.GetChannelInformation(&helix.GetChannelInformationParams{
		BroadcasterID: "94753024",
	})
	if err != nil {
		panic(err)
	}

	fmt.Println(resp.Data)
}
